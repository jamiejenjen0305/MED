<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦ºçŸ¥æ£®æ—ï¼šå…«å¤§äººè¦ºä¿®è¡Œä¹‹æ—…</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React èˆ‡ Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å¼•å…¥ Lucide åœ–æ¨™åº« -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;900&display=swap');
        
        body {
            margin: 0;
            background-color: #020617;
            font-family: 'Noto Serif TC', serif;
            color: white;
            overflow: hidden;
        }

        @keyframes firefly { 
            0%, 100% { transform: translate(0, 0); opacity: 0.1; } 
            50% { transform: translate(40px, -60px); opacity: 0.3; } 
        }
        @keyframes float-island { 
            0%, 100% { transform: translateY(0); } 
            50% { transform: translateY(-15px); } 
        }
        @keyframes spin-slow { 
            from { transform: rotate(0deg); } 
            to { transform: rotate(360deg); } 
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        @keyframes glow-flow {
            0% { filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.4)); }
            50% { filter: drop-shadow(0 0 30px rgba(251, 191, 36, 0.8)); }
            100% { filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.4)); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ä¿®æ­£ï¼šæ–‡å­—è¢ç«èŸ²é£„å‹•æ•ˆæœ - ç¯„åœåŠ å¤§ */
        @keyframes star-float {
            0% { transform: translate(0, 0); }
            25% { transform: translate(80px, -100px); }
            50% { transform: translate(-60px, 80px); }
            75% { transform: translate(-100px, -60px); }
            100% { transform: translate(0, 0); }
        }

        .animate-firefly { animation: firefly 15s ease-in-out infinite; }
        .animate-float-island { animation: float-island 6s ease-in-out infinite; }
        .animate-spin-slow { animation: spin-slow 25s linear infinite; }
        .animate-pulse-ring { animation: pulse-ring 3s cubic-bezier(0.24, 0, 0.38, 1) infinite; }
        .animate-glow-flow { animation: glow-flow 4s ease-in-out infinite; }
        .animate-shake { animation: shake 0.4s ease-in-out; }
        .animate-star-float { animation: star-float 15s ease-in-out infinite; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 10px; }
        
        .text-shadow-md {
            text-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }

        .level-card {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- ä½›èªªå…«å¤§äººè¦ºç¶“ å®Œæ•´å…§å®¹é…ç½® ---
        const SCRIPTURE_INTRO = "ç‚ºä½›å¼Ÿå­ï¼Œå¸¸æ–¼æ™å¤œï¼Œè‡³å¿ƒèª¦å¿µï¼Œå…«å¤§äººè¦ºã€‚";

        const SCRIPTURE_EPILOGUE_GROUPS = [
            {
                id: "e1",
                phrases: ["å¦‚æ­¤å…«äº‹", "ä¹ƒæ˜¯è«¸ä½›", "è©è–©å¤§äºº", "ä¹‹æ‰€è¦ºæ‚Ÿ", "ç²¾é€²è¡Œé“", "æ…ˆæ‚²ä¿®æ…§", "ä¹˜æ³•èº«èˆ¹", "è‡³æ¶…æ§ƒå²¸", "å¾©é‚„ç”Ÿæ­»", "åº¦è„«çœ¾ç”Ÿ"],
                full: "å¦‚æ­¤å…«äº‹ï¼Œä¹ƒæ˜¯è«¸ä½›è©è–©å¤§äººä¹‹æ‰€è¦ºæ‚Ÿï¼Œç²¾é€²è¡Œé“ï¼Œæ…ˆæ‚²ä¿®æ…§ï¼Œä¹˜æ³•èº«èˆ¹ï¼Œè‡³æ¶…æ§ƒå²¸ï¼Œå¾©é‚„ç”Ÿæ­»ï¼Œåº¦è„«çœ¾ç”Ÿã€‚"
            },
            {
                id: "e2",
                phrases: ["ä»¥å‰å…«äº‹", "é–‹å°ä¸€åˆ‡", "ä»¤è«¸çœ¾ç”Ÿ", "è¦ºç”Ÿæ­»è‹¦", "æ¨é›¢äº”æ¬²", "ä¿®å¿ƒè–é“"],
                full: "ä»¥å‰å…«äº‹ï¼Œé–‹å°ä¸€åˆ‡ï¼Œä»¤è«¸çœ¾ç”Ÿï¼Œè¦ºç”Ÿæ­»è‹¦ï¼Œæ¨é›¢äº”æ¬²ï¼Œä¿®å¿ƒè–é“ã€‚"
            },
            {
                id: "e3",
                phrases: ["è‹¥ä½›å¼Ÿå­", "èª¦æ­¤å…«äº‹", "æ–¼å¿µå¿µä¸­", "æ»…ç„¡é‡ç½ª", "é€²è¶£è©æ", "é€Ÿç™»æ­£è¦º", "æ°¸æ–·ç”Ÿæ­»", "å¸¸ä½å¿«æ¨‚"],
                full: "è‹¥ä½›å¼Ÿå­ï¼Œèª¦æ­¤å…«äº‹ï¼Œæ–¼å¿µå¿µä¸­ï¼Œæ»…ç„¡é‡ç½ªï¼Œé€²è¶£è©æï¼Œé€Ÿç™»æ­£è¦ºï¼›æ°¸æ–·ç”Ÿæ­»ï¼Œå¸¸ä½å¿«æ¨‚ã€‚"
            }
        ];

        const SCRIPTURE_OUTRO = `å¦‚æ­¤å…«äº‹ï¼Œä¹ƒæ˜¯è«¸ä½›è©è–©å¤§äººä¹‹æ‰€è¦ºæ‚Ÿï¼Œç²¾é€²è¡Œé“ï¼Œæ…ˆæ‚²ä¿®æ…§ï¼Œä¹˜æ³•èº«èˆ¹ï¼Œè‡³æ¶…æ§ƒå²¸ï¼Œå¾©é‚„ç”Ÿæ­»ï¼Œåº¦è„«çœ¾ç”Ÿã€‚ä»¥å‰å…«äº‹ï¼Œé–‹å°ä¸€åˆ‡ï¼Œä»¤è«¸çœ¾ç”Ÿï¼Œè¦ºç”Ÿæ­»è‹¦ï¼Œæ¨é›¢äº”æ¬²ï¼Œä¿®å¿ƒè–é“ã€‚è‹¥ä½›å¼Ÿå­ï¼Œèª¦æ­¤å…«äº‹ï¼Œæ–¼å¿µå¿µä¸­ï¼Œæ»…ç„¡é‡ç½ªï¼Œé€²è¶£è©æï¼Œé€Ÿç™»æ­£è¦ºï¼›æ°¸æ–·ç”Ÿæ­»ï¼Œå¸¸ä½å¿«æ¨‚ã€‚`;

        const LEVELS = [
            { 
                id: 1, title: "ç¬¬ä¸€è¦ºæ‚Ÿ", subtitle: "ç„¡å¸¸è¦º", 
                image: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&q=80&w=400", 
                bg: "https://images.unsplash.com/photo-1501854140801-50d01698950b?auto=format&fit=crop&q=80&w=1200",
                scripture: ["ç¬¬ä¸€è¦ºæ‚Ÿ", "ä¸–é–“ç„¡å¸¸", "åœ‹åœŸå±è„†", "å››å¤§è‹¦ç©º", "äº”é™°ç„¡æˆ‘", "ç”Ÿæ»…è®Šç•°", "è™›å½ç„¡ä¸»", "å¿ƒæ˜¯æƒ¡æº", "å½¢ç‚ºç½ªè—ª", "å¦‚æ˜¯è§€å¯Ÿ", "æ¼¸é›¢ç”Ÿæ­»"],
                full: "ç¬¬ä¸€è¦ºæ‚Ÿï¼Œä¸–é–“ç„¡å¸¸ï¼Œåœ‹åœŸå±è„†ï¼›å››å¤§è‹¦ç©ºï¼Œäº”é™°ç„¡æˆ‘ï¼Œç”Ÿæ»…è®Šç•°ï¼Œè™›å½ç„¡ä¸»ï¼›å¿ƒæ˜¯æƒ¡æºï¼Œå½¢ç‚ºç½ªè—ªï¼›å¦‚æ˜¯è§€å¯Ÿï¼Œæ¼¸é›¢ç”Ÿæ­»ã€‚",
                time: 100,
                bgm: "https://jamiejenjen0305.github.io/MED/8-1.mp3"
            },
            { 
                id: 2, title: "ç¬¬äºŒè¦ºçŸ¥", subtitle: "å¤šæ¬²è¦º", 
                image: "https://images.unsplash.com/photo-1513519245088-0e12902e5a38?auto=format&fit=crop&q=80&w=400", 
                bg: "https://images.unsplash.com/photo-1440778303588-435521a205bc?auto=format&fit=crop&q=80&w=1200",
                scripture: ["ç¬¬äºŒè¦ºçŸ¥", "å¤šæ¬²ç‚ºè‹¦", "ç”Ÿæ­»ç–²å‹", "å¾è²ªæ¬²èµ·", "å°‘æ¬²ç„¡ç‚º", "èº«å¿ƒè‡ªåœ¨"],
                full: "ç¬¬äºŒè¦ºçŸ¥ï¼Œå¤šæ¬²ç‚ºè‹¦ï¼Œç”Ÿæ­»ç–²å‹ï¼Œå¾è²ªæ¬²èµ·ï¼Œå°‘æ¬²ç„¡ç‚ºï¼Œèº«å¿ƒè‡ªåœ¨ã€‚",
                time: 60,
                bgm: "https://jamiejenjen0305.github.io/MED/8-2.mp3"
            },
            { 
                id: 3, title: "ç¬¬ä¸‰è¦ºçŸ¥", subtitle: "çŸ¥è¶³è¦º", 
                image: "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&q=80&w=400", 
                bg: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&q=80&w=1200",
                scripture: ["ç¬¬ä¸‰è¦ºçŸ¥", "å¿ƒç„¡å­è¶³", "æƒŸå¾—å¤šæ±‚", "å¢é•·ç½ªæƒ¡", "è©è–©ä¸çˆ¾", "å¸¸å¿µçŸ¥è¶³", "å®‰è²§å®ˆé“", "æƒŸæ…§æ˜¯æ¥­"],
                full: "ç¬¬ä¸‰è¦ºçŸ¥ï¼Œå¿ƒç„¡å­è¶³ï¼ŒæƒŸå¾—å¤šæ±‚ï¼Œå¢é•·ç½ªæƒ¡ï¼›è©è–©ä¸çˆ¾ï¼Œå¸¸å¿µçŸ¥è¶³ï¼Œå®‰è²§å®ˆé“ï¼ŒæƒŸæ…§æ˜¯æ¥­ã€‚",
                time: 80,
                bgm: "https://jamiejenjen0305.github.io/MED/8-3.mp3"
            },
            { 
                id: 4, title: "ç¬¬å››è¦ºçŸ¥", subtitle: "ç²¾é€²è¦º", 
                image: "https://images.unsplash.com/photo-1502082553048-f009c37129b9?auto=format&fit=crop&q=80&w=400", 
                bg: "https://images.unsplash.com/photo-1511497584788-8767fe771d21?auto=format&fit=crop&q=80&w=1200",
                scripture: ["ç¬¬å››è¦ºçŸ¥", "æ‡ˆæ€ å¢œè½", "å¸¸è¡Œç²¾é€²", "ç ´ç…©æƒ±æƒ¡", "æ‘§ä¼å››é­”", "å‡ºé™°ç•Œç„"],
                full: "ç¬¬å››è¦ºçŸ¥æ¨™, æ‡ˆæ€ å¢œè½ï¼›å¸¸è¡Œç²¾é€²ï¼Œç ´ç…©æƒ±æƒ¡ï¼Œæ‘§ä¼å››é­”ï¼Œå‡ºé™°ç•Œç„ã€‚",
                time: 60,
                bgm: "https://jamiejenjen0305.github.io/MED/8-4.mp3"
            },
            { 
                id: 5, title: "ç¬¬äº”è¦ºæ‚Ÿ", subtitle: "æ™ºæ…§è¦º", 
                image: "https://images.unsplash.com/photo-1507499739999-097706ad8914?auto=format&fit=crop&q=80&w=400", 
                bg: "https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?auto=format&fit=crop&q=80&w=1200",
                scripture: ["ç¬¬äº”è¦ºæ‚Ÿ", "æ„šç™¡ç”Ÿæ­»", "è©è–©å¸¸å¿µ", "å»£å­¸å¤šè", "å¢é•·æ™ºæ…§", "æˆå°±è¾¯æ‰", "æ•™åŒ–ä¸€åˆ‡", "æ‚‰ä»¥å¤§æ¨‚"],
                full: "ç¬¬äº”è¦ºæ‚Ÿï¼Œæ„šç™¡ç”Ÿæ­»ï¼Œè©è–©å¸¸å¿µï¼Œå»£å­¸å¤šèï¼Œå¢é•·æ™ºæ…§ï¼Œæˆå°±è¾¯æ‰ï¼Œæ•™åŒ–ä¸€åˆ‡ï¼Œæ‚‰ä»¥å¤§æ¨‚ã€‚",
                time: 80,
                bgm: "https://jamiejenjen0305.github.io/MED/8-5.mp3"
            },
            { 
                id: 6, title: "ç¬¬å…­è¦ºçŸ¥", subtitle: "å¸ƒæ–½è¦º", 
                image: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&q=80&w=400", 
                bg: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&q=80&w=1200",
                scripture: ["ç¬¬å…­è¦ºçŸ¥", "è²§è‹¦å¤šæ€¨", "æ©«çµæƒ¡ç·£", "è©è–©å¸ƒæ–½", "ç­‰å¿µæ€¨è¦ª", "ä¸å¿µèˆŠæƒ¡", "ä¸æ†æƒ¡äºº"],
                full: "ç¬¬å…­è¦ºçŸ¥ï¼Œè²§è‹¦å¤šæ€¨ï¼Œæ©«çµæƒ¡ç·£ï¼›è©è–©å¸ƒæ–½ï¼Œç­‰å¿µæ€¨è¦ªï¼Œä¸å¿µèˆŠæƒ¡ï¼Œä¸æ†æƒ¡äººã€‚",
                time: 80,
                bgm: "https://jamiejenjen0305.github.io/MED/8-6.mp3"
            },
            { 
                id: 7, title: "ç¬¬ä¸ƒè¦ºæ‚Ÿ", subtitle: "æ¢µè¡Œè¦º", 
                image: "https://images.unsplash.com/photo-1518128958364-65859d70aa41?auto=format&fit=crop&q=80&w=400", 
                bg: "https://images.unsplash.com/photo-1518128958364-65859d70aa41?auto=format&fit=crop&q=80&w=1200",
                scripture: ["ç¬¬ä¸ƒè¦ºæ‚Ÿ", "äº”æ¬²éæ‚£", "é›–ç‚ºä¿—äºº", "ä¸æŸ“ä¸–æ¨‚", "å¸¸å¿µä¸‰è¡£", "ç“¦ç¼½æ³•å™¨", "å¿—é¡˜å‡ºå®¶", "å®ˆé“æ¸…ç™½", "æ¢µè¡Œé«˜é ", "æ…ˆæ‚²ä¸€åˆ‡"],
                full: "ç¬¬ä¸ƒè¦ºæ‚Ÿï¼Œäº”æ¬²éæ‚£ï¼›é›–ç‚ºä¿—äººï¼Œä¸æŸ“ä¸–æ¨‚ï¼Œå¸¸å¿µä¸‰è¡£ï¼Œç“¦ç¼½æ³•å™¨ï¼Œå¿—é¡˜å‡ºå®¶ï¼Œå®ˆé“æ¸…ç™½ï¼Œæ¢µè¡Œé«˜é ï¼Œæ…ˆæ‚²ä¸€åˆ‡ã€‚",
                time: 120,
                bgm: "https://jamiejenjen0305.github.io/MED/8-7.mp3"
            },
            { 
                id: 8, title: "ç¬¬å…«è¦ºçŸ¥", subtitle: "å¤§å¿ƒè¦º", 
                image: "https://images.unsplash.com/photo-1472396961693-142e6e269027?auto=format&fit=crop&q=80&w=400", 
                bg: "https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?auto=format&fit=crop&q=80&w=1200",
                scripture: ["ç¬¬å…«è¦ºçŸ¥", "ç”Ÿæ­»ç†¾ç„¶", "è‹¦æƒ±ç„¡é‡", "ç™¼å¤§ä¹˜å¿ƒ", "æ™®æ¿Ÿä¸€åˆ‡", "é¡˜ä»£çœ¾ç”Ÿ", "å—ç„¡é‡è‹¦", "ä»¤è«¸çœ¾ç”Ÿ", "ç•¢ç«Ÿå¤§æ¨‚"],
                full: "ç¬¬å…«è¦ºçŸ¥ï¼Œç”Ÿæ­»ç†¾ç„¶ï¼Œè‹¦æƒ±ç„¡é‡ï¼Œç™¼å¤§ä¹˜å¿ƒï¼Œæ™®æ¿Ÿä¸€åˆ‡ï¼›é¡˜ä»£çœ¾ç”Ÿï¼Œå—ç„¡é‡è‹¦ï¼›ä»¤è«¸çœ¾ç”Ÿï¼Œç•¢ç«Ÿå¤§æ¨‚ã€‚",
                time: 120,
                bgm: "https://jamiejenjen0305.github.io/MED/8-8.mp3"
            }
        ];

        // --- æ ¸å¿ƒèªéŸ³ç³»çµ± ---
        const speakText = (text, onEnd) => {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-TW';
            utterance.rate = 0.75;
            utterance.pitch = 0.95;

            const voices = window.speechSynthesis.getVoices();
            const preferredVoice = voices.find(v => v.lang.includes('zh-TW') && v.name.includes('Microsoft')) || 
                                   voices.find(v => v.lang.includes('zh-TW')) ||
                                   voices.find(v => v.lang.includes('zh'));
            if (preferredVoice) utterance.voice = preferredVoice;

            utterance.onend = () => { if (onEnd) onEnd(); };
            window.speechSynthesis.speak(utterance);
        };

        // --- åœ–æ¨™çµ„ä»¶ ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && lucide && lucide[name]) {
                    lucide.createIcons({
                        icons: { [name]: lucide[name] },
                        attrs: { width: size, height: size, class: className }
                    });
                }
            }, [name, size, className]);
            return <i ref={iconRef} data-lucide={name} className={className}></i>;
        };

        // --- çµ„ä»¶ï¼šé¦–é  ---
        const StartScreen = ({ onStart }) => (
            <div className="flex-1 flex flex-col items-center justify-center p-12 text-center animate-in fade-in zoom-in duration-1000">
                <div className="relative mb-16">
                    <div className="w-64 h-64 rounded-[3.5rem] overflow-hidden border-4 border-emerald-400/30 shadow-[0_0_100px_rgba(52,211,153,0.3)] bg-emerald-950/10 text-center">
                        <img src="https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?auto=format&fit=crop&q=80&w=800" className="w-full h-full object-cover opacity-80" alt="Sprout" />
                    </div>
                    <div className="absolute -top-8 -right-8 bg-emerald-500/10 backdrop-blur-3xl p-6 rounded-full border border-white/20 animate-spin-slow text-emerald-300 text-center">
                        <Icon name="Sparkles" size={44} />
                    </div>
                </div>
                <h1 className="text-8xl font-black mb-8 tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-emerald-200 via-emerald-400 to-teal-300 drop-shadow-2xl text-white text-center">è¦ºçŸ¥å°å³¶</h1>
                <p className="text-2xl text-slate-100 mb-6 font-light drop-shadow-md tracking-widest uppercase text-white text-center">è½ï¼Œé‚£æ˜¯å¤§åœ°çš„ä½èª</p>
                <div className="bg-white/10 backdrop-blur-md px-10 py-4 rounded-full border border-white/20 mb-14 animate-pulse">
                    <p className="text-emerald-300 italic font-medium tracking-[0.3em]">{SCRIPTURE_INTRO}</p>
                </div>
                <button onClick={onStart} className="group bg-emerald-700 hover:bg-emerald-600 text-white px-20 py-8 rounded-full text-3xl font-black shadow-2xl transition-all transform hover:scale-105 active:scale-95 flex items-center gap-5 text-white">
                    æ­¥å…¥æ£®æ— <Icon name="ChevronRight" size={32} className="group-hover:translate-x-3 transition-transform text-white" />
                </button>
            </div>
        );

        const MapView = ({ levels, collectedIds, onSelect, onOpenJournal, onFinal, isDedicationDone }) => (
            <div className="flex-1 flex flex-col p-14 overflow-y-auto custom-scrollbar animate-in fade-in duration-700 text-center">
                <header className="mb-16 flex justify-between items-end px-6 text-shadow-md text-white">
                    <div className="text-left text-white">
                        <div className="inline-block px-6 py-2 bg-emerald-500/20 backdrop-blur-md border border-emerald-500/30 rounded-full text-sm font-black text-emerald-300 mb-6 tracking-[0.4em] uppercase shadow-lg text-white">ä¿®è¡Œä¹‹çœ¼</div>
                        <h2 className="text-6xl font-black tracking-widest drop-shadow-lg text-white">è«‹é¸æ“‡ä¿®è¡Œä¹‹å³¶</h2>
                    </div>
                    <div className="flex gap-4 text-white">
                        <button onClick={onOpenJournal} className="group relative flex items-center gap-4 bg-emerald-950/60 hover:bg-emerald-900/80 px-10 py-6 rounded-[2.5rem] border border-emerald-500/40 transition-all shadow-2xl backdrop-blur-md text-white">
                            <Icon name="BookOpen" size={32} className="text-emerald-400 text-white" />
                            <span className="text-2xl font-black text-emerald-100 text-white">æ™ºæ…§æ‰‹æœ­</span>
                            {isDedicationDone && <div className="absolute -bottom-1 -right-1 bg-amber-500 w-4 h-4 rounded-full animate-ping text-white" />}
                        </button>
                        {collectedIds.length === 8 && !isDedicationDone && (
                            <button onClick={onFinal} className="group relative flex items-center gap-4 bg-amber-600 hover:bg-amber-500 px-10 py-6 rounded-[2.5rem] shadow-2xl transition-all animate-pulse text-white">
                                <Icon name="Sparkles" size={32} className="text-white" />
                                <span className="text-2xl font-black text-white">åœ“æ»¿è¦ºçŸ¥</span>
                            </button>
                        )}
                        {isDedicationDone && (
                           <button onClick={onFinal} className="group relative flex items-center gap-4 bg-white/10 px-10 py-6 rounded-[2.5rem] border border-amber-500/30 transition-all text-white">
                             <Icon name="Waves" size={32} className="text-amber-400 text-white" />
                             <span className="text-2xl font-black text-amber-200 text-white">é‡æº«åœ“æ»¿</span>
                           </button>
                        )}
                    </div>
                </header>
                <div className="flex-1 grid grid-cols-2 md:grid-cols-4 gap-12 mb-10 px-4 text-white">
                    {levels.map((lvl, idx) => (
                        <button key={lvl.id} onClick={() => onSelect(idx)} className={`level-card relative group flex flex-col items-center p-8 rounded-[3.5rem] border-2 transition-all hover:scale-110 active:scale-95 ${collectedIds.includes(lvl.id) ? 'bg-emerald-950/40 border-emerald-500/60 shadow-[0_0_40px_rgba(52,211,153,0.3)] backdrop-blur-sm' : 'bg-white/5 border-white/10 hover:border-white/30'} text-white`} style={{ animation: `float-island ${5 + idx * 0.4}s ease-in-out infinite`, animationDelay: (idx * 0.2)+'s' }}>
                            <div className="w-36 h-36 rounded-[2.5rem] overflow-hidden mb-8 shadow-2xl relative border border-white/10 bg-black/20 text-white text-center">
                                <img src={lvl.image} className={`w-full h-full object-cover transition-all duration-1000 ${collectedIds.includes(lvl.id) ? 'grayscale-0 scale-110' : 'grayscale brightness-50'}`} alt={lvl.title} />
                            </div>
                            <span className="text-xs font-black text-emerald-300 mb-2 uppercase tracking-[0.2em]">{lvl.title}</span>
                            <h3 className="text-2xl font-black text-white drop-shadow-md">{lvl.subtitle}</h3>
                            {collectedIds.includes(lvl.id) && <div className="absolute -top-3 -right-3 bg-emerald-500 p-2 rounded-full text-white shadow-xl animate-pulse ring-4 ring-emerald-500/20 text-white text-center"><Icon name="Sparkles" size={20} className="text-white" /></div>}
                        </button>
                    ))}
                </div>
            </div>
        );

        const GameEngine = ({ level, lives, setLives, playEffect, onComplete, onBack }) => {
            const [shuffled, setShuffled] = useState([]);
            const [selected, setSelected] = useState([]);
            const [timeLeft, setTimeLeft] = useState(level.time);
            const [isFinished, setIsFinished] = useState(false);
            const [isReading, setIsReading] = useState(false);
            const [showFailure, setShowFailure] = useState(false);

            useEffect(() => {
                const arr = [...level.scripture].sort(() => Math.random() - 0.5);
                setShuffled(arr); setSelected([]); setTimeLeft(level.time); 
                setIsFinished(false); setShowFailure(false);
                return () => { window.speechSynthesis.cancel(); };
            }, [level]);

            useEffect(() => {
                if (timeLeft > 0 && !isFinished && !showFailure) {
                    const timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);
                    return () => clearInterval(timer);
                } else if (timeLeft === 0 && !isFinished) {
                    playEffect('wrong'); setShowFailure(true);
                }
            }, [timeLeft, isFinished, showFailure, playEffect]);

            const handlePhraseClick = (phrase) => {
                if (isFinished || isReading || showFailure) return;
                if (phrase === level.scripture[selected.length]) {
                    playEffect('correct');
                    const nextSelected = [...selected, phrase];
                    setSelected(nextSelected);
                    setShuffled(prev => prev.filter(p => p !== phrase));
                    if (nextSelected.length === level.scripture.length) {
                        setIsFinished(true); 
                        onComplete(); 
                        setIsReading(true);
                        speakText(level.full, () => setIsReading(false));
                    }
                } else {
                    playEffect('wrong');
                    const nextLives = lives - 1; setLives(nextLives);
                    if (nextLives <= 0) setShowFailure(true);
                }
            };

            return (
                <div className="flex-1 flex flex-col p-10 animate-in fade-in duration-500 relative text-white text-center">
                    <div className="flex justify-between items-center mb-10 px-8 drop-shadow-md text-white">
                        <button onClick={onBack} className="bg-black/40 px-6 py-3 rounded-full border border-white/10 text-slate-400 hover:text-white transition-all flex items-center gap-2 text-white">
                            <Icon name="RefreshCw" size={18} className="rotate-180 text-white" /> é€€å‡ºä¿®è¡Œ
                        </button>
                        <div className="flex items-center gap-12 text-white">
                            <div className="flex gap-4 text-white text-center">
                                {[...Array(3)].map((_, i) => (
                                    <div key={i} className={`transition-all duration-500 transform ${i < lives ? 'scale-110 opacity-100' : 'scale-50 opacity-20 rotate-45 grayscale'}`}>
                                        <Icon name="Leaf" size={48} className="text-emerald-400 fill-emerald-400/20 shadow-xl text-white" />
                                    </div>
                                ))}
                            </div>
                            <div className={`flex items-center gap-4 bg-black/40 px-10 py-4 rounded-full border-2 border-white/20 shadow-2xl backdrop-blur-sm ${timeLeft < 10 ? 'animate-pulse text-red-500 border-red-500/50' : ''}`}>
                                <Icon name="Timer" size={28} /><span className="text-4xl font-black tabular-nums">{timeLeft}s</span>
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center gap-14 text-white text-center">
                        <div className="w-full max-w-5xl flex flex-wrap justify-center gap-5 min-h-[160px] bg-black/20 border border-white/10 p-12 rounded-[5rem] backdrop-blur-sm shadow-2xl relative overflow-hidden text-center text-white">
                            {selected.map((p, i) => (
                                <div key={i} className="bg-emerald-600/80 text-white px-10 py-5 rounded-[2rem] font-black text-3xl animate-in zoom-in border-2 border-emerald-400/50 shadow-xl relative z-10 text-white text-center">{p}</div>
                            ))}
                            {selected.length < level.scripture.length && !showFailure && (
                                <div className="w-40 h-20 border-4 border-dashed border-emerald-400/20 rounded-[2.5rem] animate-pulse text-white"></div>
                            )}
                        </div>
                        {!isFinished && !showFailure && (
                            <div className="w-full max-w-5xl flex flex-wrap justify-center gap-8 text-white text-center">
                                {shuffled.map((p, i) => (
                                    <button key={i} onClick={() => handlePhraseClick(p)} className="bg-black/60 hover:bg-emerald-900/60 hover:scale-110 active:scale-95 text-emerald-50 px-10 py-6 rounded-[2.5rem] border-2 border-white/10 font-black text-3xl transition-all shadow-xl backdrop-blur-sm text-white">
                                        {p}
                                    </button>
                                ))}
                            </div>
                        )}
                    </div>

                    {isFinished && (
                        <div className="absolute inset-0 flex flex-col items-center justify-center bg-black/80 backdrop-blur-3xl z-50 animate-in fade-in duration-1000 text-white text-center">
                            <div className="max-w-5xl text-center px-12 text-white">
                                <div className="w-32 h-32 bg-emerald-500/20 rounded-[2.5rem] flex items-center justify-center mb-10 border-4 border-emerald-400 mx-auto shadow-[0_0_50px_rgba(52,211,153,0.4)] animate-float-island text-emerald-400 text-center text-white">
                                    <Icon name={isReading ? "Volume2" : "Sparkles"} size={64} className={isReading ? "animate-pulse" : ""} />
                                </div>
                                <h2 className="text-6xl font-black text-emerald-300 mb-10 tracking-[0.4em] uppercase text-shadow-md text-white text-center">è¦ºçŸ¥åœ“æ»¿</h2>
                                <div className="bg-white/5 p-20 rounded-[4rem] border border-white/10 shadow-[0_30px_100px_rgba(0,0,0,0.5)] mb-14 relative overflow-hidden text-white text-center">
                                   <p className="text-5xl font-black text-white leading-[1.8] italic relative z-10 drop-shadow-2xl text-center" style={{ fontFamily: 'Noto Serif TC' }}>ã€Œ{level.full}ã€</p>
                                </div>
                                <button onClick={onBack} disabled={isReading} className={`bg-white text-slate-900 px-20 py-8 rounded-full font-black text-4xl shadow-2xl transition-all hover:scale-105 active:scale-95 flex items-center gap-6 mx-auto text-slate-900 ${isReading ? 'opacity-50 cursor-wait' : ''}`}>
                                    è¿”å›åœ°åœ– <Icon name="ChevronRight" size={48} className="text-slate-900" />
                                </button>
                                {isReading && <p className="mt-8 text-emerald-400/60 text-xl font-bold animate-pulse tracking-widest text-white text-center">æ™ºæ…§æ³•éŸ³æµè½‰ä¸­...</p>}
                            </div>
                        </div>
                    )}

                    {showFailure && (
                        <div className="absolute inset-0 flex flex-col items-center justify-center bg-red-950/90 backdrop-blur-3xl z-50 animate-in fade-in text-white text-center text-white">
                            <Icon name="AlertCircle" size={150} className="text-red-500 mb-10 animate-bounce text-white text-white" />
                            <h2 className="text-8xl font-black text-white mb-8 tracking-tighter text-white">å¿ƒç¥å·²äº‚</h2>
                            <p className="text-3xl text-red-200 mb-16 font-light text-white text-center text-white">ä¿®è¡Œå°šæœªç©©å›ºï¼Œè«‹é‡æ–°å®šå¿ƒå†è©¦ã€‚</p>
                            <button onClick={onBack} className="bg-white text-slate-900 px-20 py-8 rounded-full font-black text-4xl shadow-2xl hover:scale-105 active:scale-95 transition-all text-slate-900 text-slate-900">é‡æ–°å®šå¿ƒ</button>
                        </div>
                    )}
                </div>
            );
        };

        // --- çµ„ä»¶ï¼šåœ“æ»¿è¦ºçŸ¥ (æ›´æ–°ä½ˆå±€èˆ‡å‹•æ…‹ç¯„åœ) ---
        const DedicationScene = ({ onFinish }) => {
            const [groupStep, setGroupStep] = useState(0); 
            const [interactionMode, setInteractionMode] = useState('memorize'); 
            const [correctSequence, setCorrectSequence] = useState([]);
            const [shuffledStars, setShuffledStars] = useState([]);
            const [isReading, setIsReading] = useState(false);
            const [errorStar, setErrorStar] = useState(null);

            useEffect(() => {
                if (groupStep >= SCRIPTURE_EPILOGUE_GROUPS.length) return;
                
                const group = SCRIPTURE_EPILOGUE_GROUPS[groupStep];
                const stars = group.phrases.map((text, index) => ({
                    id: index,
                    text,
                    // ä¿®æ­£ï¼šæ“´å¤§å­—é«”åˆå§‹åˆ†æ•£å€åŸŸ
                    x: 5 + Math.random() * 85, 
                    y: 10 + Math.random() * 75,
                    delay: `${Math.random() * -15}s`,
                    duration: `${10 + Math.random() * 10}s`
                }));
                
                setShuffledStars([...stars].sort(() => Math.random() - 0.5));
                setCorrectSequence([]);
                setInteractionMode('memorize');

                const timer = setTimeout(() => setInteractionMode('link'), 3800);
                return () => clearTimeout(timer);
            }, [groupStep]);

            const handleStarClick = (star) => {
                if (interactionMode !== 'link' || isReading) return;

                const group = SCRIPTURE_EPILOGUE_GROUPS[groupStep];
                const nextTargetIndex = correctSequence.length;
                const nextTargetText = group.phrases[nextTargetIndex];

                if (star.text === nextTargetText) {
                    const newSequence = [...correctSequence, star.text];
                    setCorrectSequence(newSequence);
                    
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(1000 + (nextTargetIndex * 150), ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 1.2);
                    osc.connect(gain); gain.connect(ctx.destination);
                    osc.start(); osc.stop(ctx.currentTime + 1.2);

                    if (newSequence.length === group.phrases.length) {
                        setIsReading(true);
                        speakText(group.full, () => {
                            setIsReading(false);
                            if (groupStep < SCRIPTURE_EPILOGUE_GROUPS.length - 1) {
                                setGroupStep(groupStep + 1);
                            } else {
                                setInteractionMode('finished');
                                setTimeout(onFinish, 2000);
                            }
                        });
                    }
                } else {
                    setErrorStar(star.id);
                    setTimeout(() => setErrorStar(null), 500);
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(90, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.6);
                    osc.connect(gain); gain.connect(ctx.destination);
                    osc.start(); osc.stop(ctx.currentTime + 0.6);
                }
            };

            const currentGroup = SCRIPTURE_EPILOGUE_GROUPS[groupStep];

            return (
                <div className="flex-1 flex flex-col items-center justify-center p-20 animate-in fade-in duration-2000 relative text-white text-center text-white">
                    <div className="absolute inset-0 bg-gradient-to-br from-emerald-950/40 via-[#020617] to-amber-950/40 backdrop-blur-3xl text-white text-center text-white"></div>
                    
                    <div className="relative z-10 w-full h-full flex flex-col items-center text-white text-center text-white">
                        <header className="mb-12 text-white text-center text-white">
                            <h2 className="text-5xl font-black text-amber-200 tracking-[0.5em] mb-4 uppercase text-shadow-md text-white text-center text-white">åœ“æ»¿è¦ºçŸ¥</h2>
                            <div className="inline-block px-8 py-2 rounded-full border border-emerald-500/30 bg-emerald-500/10 backdrop-blur-md text-white text-center text-white">
                                <p className="text-emerald-300 font-bold tracking-widest text-lg text-white text-center text-white text-white">
                                    {interactionMode === 'memorize' ? "è‡³å¿ƒå‡è¦– Â· éŠ˜åˆ»æ™ºæ…§" : isReading ? "æ³•éŸ³æµè½‰ Â· è¦ºæ€§æ˜‡è¯" : "æ–‡å­—å¦‚è¢ Â· è¦ºæ€§é€£ç·š"}
                                </p>
                            </div>
                        </header>

                        <div className="flex-1 w-full relative min-h-[550px] text-white text-center text-white">
                            {interactionMode === 'memorize' ? (
                                <div className="absolute inset-0 flex items-center justify-center animate-in fade-in zoom-in duration-1000 text-white text-center text-white">
                                    <div className="bg-black/40 p-16 rounded-[4rem] border-2 border-amber-500/20 shadow-[0_0_80px_rgba(251,191,36,0.2)] backdrop-blur-xl text-white text-center text-white text-center text-white">
                                        <p className="text-5xl font-black text-amber-100 leading-relaxed italic text-center text-white text-center text-white" style={{ fontFamily: 'Noto Serif TC' }}>
                                            ã€Œ{currentGroup.full}ã€
                                        </p>
                                    </div>
                                </div>
                            ) : (
                                <div className="w-full h-full relative text-white text-center text-white text-white">
                                    {shuffledStars.map((star) => {
                                        const isCorrect = correctSequence.includes(star.text);
                                        const isError = errorStar === star.id;

                                        return (
                                            <div 
                                                key={star.id}
                                                onClick={() => handleStarClick(star)}
                                                className={`absolute cursor-pointer transition-all duration-700 transform flex flex-col items-center group text-white text-center text-white text-white
                                                    ${isCorrect ? 'scale-110 opacity-100' : 'hover:scale-125'} 
                                                    ${isError ? 'animate-shake' : ''}
                                                    ${!isCorrect ? 'animate-star-float' : ''}`}
                                                style={{ 
                                                    left: `${star.x}%`, 
                                                    top: `${star.y}%`,
                                                    animationDelay: star.delay,
                                                    animationDuration: star.duration
                                                }}
                                            >
                                                <div className={`w-3 h-3 rounded-full mb-4 transition-all duration-500 text-white text-center text-white text-white
                                                    ${isCorrect ? 'bg-amber-400 shadow-[0_0_40px_rgba(251,191,36,1)] scale-150' : 'bg-white/40 group-hover:bg-white shadow-[0_0_15px_rgba(255,255,255,0.4)]'}`}>
                                                </div>
                                                <div className={`px-6 py-3 rounded-2xl border transition-all duration-700 font-black text-2xl backdrop-blur-md shadow-xl text-white text-center text-white text-white
                                                    ${isCorrect 
                                                        ? 'bg-amber-500/20 border-amber-400 text-amber-200' 
                                                        : 'bg-black/30 border-white/5 text-white/40 group-hover:text-white group-hover:border-white/30'}`}>
                                                    {star.text}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    
                                    {isReading && (
                                        <div className="absolute bottom-0 w-full animate-in slide-in-from-bottom duration-1000 text-center text-white text-center text-white">
                                            <div className="bg-emerald-950/40 px-12 py-10 rounded-[3rem] border-2 border-emerald-500/30 shadow-[0_0_60px_rgba(16,185,129,0.3)] backdrop-blur-xl text-white text-center text-white text-center text-white">
                                                <p className="text-4xl font-black text-white italic text-center drop-shadow-lg text-white text-center text-white text-center text-white">ã€Œ{currentGroup.full}ã€</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        <div className="mt-12 flex gap-6 text-white text-center text-white">
                            {[0, 1, 2].map(i => (
                                <div key={i} className={`w-4 h-4 rounded-full border-2 border-white/20 transition-all duration-700 ${i < groupStep ? 'bg-emerald-400 border-emerald-400 shadow-[0_0_15px_rgba(52,211,153,0.8)]' : i === groupStep ? 'bg-amber-400 border-amber-400 animate-pulse shadow-[0_0_15px_rgba(251,191,36,0.8)]' : 'bg-white/5'}`} />
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const JournalView = ({ levels, collectedIds, onClose, isDedicationDone }) => (
            <div className="flex-1 flex flex-col p-20 animate-in slide-in-from-right duration-700 overflow-hidden relative text-shadow-sm text-white text-center">
                <header className="mb-16 flex justify-between items-center relative z-10 border-b border-white/20 pb-10 text-white">
                    <div className="text-left text-white">
                        <h2 className="text-7xl font-black bg-clip-text text-transparent bg-gradient-to-r from-amber-200 via-amber-400 to-amber-600 tracking-tighter text-white">æ™ºæ…§æ‰‹æœ­</h2>
                        <p className="text-slate-300 mt-4 font-bold tracking-[0.4em] uppercase text-lg text-white">Treasury of Eight Realizations</p>
                    </div>
                    <button onClick={onClose} className="bg-black/50 hover:bg-black/70 px-16 py-6 rounded-full border-2 border-white/20 font-black text-2xl transition-all shadow-2xl backdrop-blur-xl uppercase tracking-widest text-white">è¿”å›</button>
                </header>
                <div className="flex-1 overflow-y-auto custom-scrollbar pr-10 relative z-10 space-y-14 pb-20 text-white">
                    {collectedIds.length === 0 && !isDedicationDone ? (
                        <div className="h-full flex flex-col items-center justify-center text-slate-300 italic text-center text-white">
                            <Icon name="ScrollText" size={150} className="mb-10 opacity-10 animate-pulse mx-auto text-white text-center" />
                            <p className="text-3xl tracking-[0.3em] drop-shadow-md text-white text-center">æ‰‹æœ­ç©ºç©ºï¼Œå¾…æ‚¨æ­¥å…¥æ£®æ—ï¼Œå‡èšè¦ºçŸ¥...</p>
                        </div>
                    ) : (
                        <>
                            {levels.filter(l => collectedIds.includes(l.id)).map((level) => (
                                <div key={level.id} className="bg-black/50 p-16 rounded-[5rem] border border-white/10 shadow-[0_30px_100px_rgba(0,0,0,0.5)] transition-all hover:bg-black/60 backdrop-blur-md group text-white text-center text-center text-center">
                                    <div className="flex items-center gap-10 mb-12 text-white text-left">
                                        <div className="w-28 h-28 rounded-3xl overflow-hidden border-2 border-amber-500/40 shadow-2xl text-white">
                                            <img src={level.image} className="w-full h-full object-cover" alt={level.title} />
                                        </div>
                                        <div className="text-left text-white">
                                            <span className="text-sm font-black text-amber-500 uppercase tracking-[0.4em] mb-3 block text-white text-center">{level.title}</span>
                                            <h4 className="text-5xl font-black text-white tracking-widest text-white text-center">{level.subtitle}</h4>
                                        </div>
                                    </div>
                                    <p className="text-4xl font-black text-emerald-50 leading-[1.8] italic drop-shadow-xl text-center text-white text-center" style={{ fontFamily: 'Noto Serif TC' }}>ã€Œ{level.full}ã€</p>
                                </div>
                            ))}
                            {isDedicationDone && (
                                <div className="bg-amber-950/40 p-16 rounded-[5rem] border border-amber-500/30 shadow-[0_0_80px_rgba(251,191,36,0.2)] transition-all backdrop-blur-xl group mt-20 relative overflow-hidden text-white text-center text-center text-center">
                                   <div className="absolute top-0 right-0 w-64 h-64 bg-amber-500/5 blur-3xl rounded-full text-white text-center" />
                                   <div className="flex items-center gap-10 mb-12 text-white text-left text-center text-center">
                                     <div className="w-28 h-28 rounded-full bg-amber-600/20 flex items-center justify-center border-2 border-amber-400 shadow-2xl text-amber-400 text-center text-center text-white">
                                       <Icon name="Waves" size={60} className="text-amber-400 text-center text-white text-center" />
                                     </div>
                                     <div className="text-left text-white">
                                       <span className="text-sm font-black text-amber-500 uppercase tracking-[0.4em] mb-3 block text-white text-center">åœ“æ»¿è¦ºçŸ¥ç« </span>
                                       <h4 className="text-5xl font-black text-amber-200 tracking-widest text-white text-center">è¦ºçŸ¥å…¨æ–‡</h4>
                                     </div>
                                   </div>
                                   <p className="text-4xl font-black text-amber-50 leading-[2.2] italic drop-shadow-xl text-center text-white text-center" style={{ fontFamily: 'Noto Serif TC' }}>ã€Œ{SCRIPTURE_OUTRO}ã€</p>
                                </div>
                            )}
                        </>
                    )}
                </div>
            </div>
        );

        const FinalResult = ({ levels, onRestart }) => (
            <div className="flex-1 flex flex-col p-20 overflow-y-auto custom-scrollbar animate-in fade-in duration-2000 text-shadow-sm text-white text-center">
                <header className="text-center mb-24 text-white text-center text-center">
                    <div className="text-9xl mb-12 animate-float-island drop-shadow-[0_0_80px_rgba(52,211,153,0.5)] mx-auto flex justify-center items-center h-48 text-emerald-400 text-white text-center text-white">ğŸŒ³</div>
                    <h1 className="text-9xl font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-emerald-200 via-teal-100 to-blue-400 mb-10 drop-shadow-2xl text-white text-center">å…«è¦ºåœ“æ»¿</h1>
                    <p className="text-4xl text-slate-100 font-light tracking-[0.2em] max-w-5xl mx-auto leading-[1.6] text-white text-center">å–„å“‰ï¼è¦ºçŸ¥å·²æˆåƒå¤©å¤§æ¨¹ï¼Œæ™ºæ…§æ°¸é§æ–¼å¿ƒã€‚</p>
                </header>
                <div className="max-w-6xl mx-auto space-y-20 mb-32 text-white text-center">
                    <div className="bg-black/40 backdrop-blur-3xl p-20 rounded-[6rem] border border-emerald-500/30 shadow-[0_40px_120px_rgba(0,0,0,0.8)] text-white text-center text-center text-white">
                        <h3 className="text-emerald-400 font-black mb-16 tracking-[0.8em] uppercase text-2xl border-b border-emerald-500/20 pb-10 text-center italic text-white text-white text-center text-white">ä½›èªªå…«å¤§äººè¦ºç¶“ Â· åœ“æ»¿ç¸½è¦½</h3>
                        <div className="space-y-20 text-white text-center text-center text-white text-center text-white">
                            {levels.map((lvl) => (
                                <div key={lvl.id} className="space-y-8 text-left text-white text-center text-center text-white text-center text-white">
                                    <div className="flex items-center gap-8 text-white text-center text-center text-white text-center text-white text-center text-white text-center text-white"><span className="w-16 h-16 rounded-full bg-emerald-500/20 flex items-center justify-center text-2xl text-emerald-200 font-black border border-emerald-500/40 text-white text-center text-center text-white text-center text-white text-center text-white">{lvl.id}</span><span className="text-4xl font-black text-emerald-300 tracking-[0.3em] text-white text-center text-center text-white text-center text-white text-center text-white text-center text-white">{lvl.subtitle}</span></div>
                                    <p className="text-3xl font-bold text-white italic leading-[2] pl-24 border-l-4 border-emerald-500/20 text-left text-white text-center text-center text-white text-center text-white text-center text-white text-center text-white">ã€Œ{lvl.full}ã€</p>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="bg-black/50 p-24 rounded-[6rem] border border-white/20 shadow-2xl backdrop-blur-xl relative overflow-hidden text-center text-white text-center text-white text-center text-white">
                        <p className="text-4xl text-white leading-[2.4] font-light whitespace-pre-wrap italic drop-shadow-2xl text-white text-center text-white text-center text-white text-center text-white">ã€Œ{SCRIPTURE_OUTRO}ã€</p>
                    </div>
                </div>
                <button onClick={onRestart} className="bg-white text-slate-900 px-32 py-10 rounded-full font-black text-5xl shadow-2xl mx-auto flex items-center gap-10 active:scale-95 transition-all mb-32 hover:bg-emerald-50 text-slate-900 text-center text-slate-900 text-center text-slate-900 text-center text-slate-900 text-center">
                    <Icon name="RefreshCw" size={56} className="text-slate-900 text-slate-900" /> é‡æ–°ä¿®å¿ƒ
                </button>
            </div>
        );

        function App() {
            const [view, setView] = useState('start');
            const [collectedIds, setCollectedIds] = useState([]);
            const [currentIdx, setCurrentIdx] = useState(0);
            const [lives, setLives] = useState(3);
            const [isDedicationDone, setIsDedicationDone] = useState(false);
            
            const bgmRef = useRef(null);
            const audioContextRef = useRef(null);

            useEffect(() => {
                if (!audioContextRef.current) audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                window.speechSynthesis.getVoices();
            }, []);

            const playBgm = (url) => {
                if (bgmRef.current) bgmRef.current.pause();
                bgmRef.current = new Audio(url); bgmRef.current.loop = true; bgmRef.current.volume = 0.2;
                bgmRef.current.play().catch(() => {});
            };

            const playEffect = (type) => {
                const ctx = audioContextRef.current; if (!ctx) return;
                const osc = ctx.createOscillator(); const gain = ctx.createGain();
                osc.connect(gain); gain.connect(ctx.destination);
                if (type === 'correct') {
                    osc.type = 'sine'; osc.frequency.setValueAtTime(880, ctx.currentTime);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    osc.start(); osc.stop(ctx.currentTime + 0.2);
                } else {
                    osc.type = 'sawtooth'; osc.frequency.setValueAtTime(220, ctx.currentTime);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime); gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                    osc.start(); osc.stop(ctx.currentTime + 0.3);
                }
            };

            return (
                <div className="min-h-screen relative overflow-hidden flex items-center justify-center">
                    <div className="absolute inset-0 z-0 text-center text-white">
                        <img src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&q=80&w=1600" className="w-full h-full object-cover opacity-60 scale-105 text-white text-center text-white text-center" alt="æ£®æ—èƒŒæ™¯" />
                        <div className="absolute inset-0 bg-gradient-to-b from-black/70 via-transparent to-black/80 text-white text-center text-white text-center"></div>
                        <div className="absolute inset-0 pointer-events-none overflow-hidden text-center text-white text-center text-white text-center">
                            {[...Array(20)].map((_, i) => (
                                <div key={i} className="absolute rounded-full bg-emerald-400/20 blur-xl animate-firefly text-white text-center text-white text-center text-white text-center"
                                    style={{ width: Math.random()*150+50+'px', height: Math.random()*150+50+'px', top: Math.random()*100+'%', left: Math.random()*100+'%', animationDuration: Math.random()*10+10+'s', animationDelay: `${Math.random()*5}s` }}
                                />
                            ))}
                        </div>
                    </div>

                    <div className="relative z-10 w-full max-w-6xl h-[850px] mx-4 overflow-hidden flex flex-col transition-all duration-700 text-white text-center text-white text-center text-white text-center">
                        {view === 'start' && <StartScreen onStart={() => setView('map')} />}
                        {view === 'map' && <MapView levels={LEVELS} collectedIds={collectedIds} onSelect={(idx) => { setCurrentIdx(idx); setLives(3); setView('playing'); playBgm(LEVELS[idx].bgm); }} onOpenJournal={() => setView('journal')} onFinal={() => setView('dedication')} isDedicationDone={isDedicationDone} />}
                        {view === 'playing' && (
                            <GameEngine 
                                level={LEVELS[currentIdx]} lives={lives} setLives={setLives} playEffect={playEffect}
                                onComplete={() => setCollectedIds(prev => Array.from(new Set([...prev, LEVELS[currentIdx].id])))}
                                onBack={() => { if(bgmRef.current) bgmRef.current.pause(); window.speechSynthesis.cancel(); setView('map'); }}
                            />
                        )}
                        {view === 'journal' && <JournalView levels={LEVELS} collectedIds={collectedIds} onClose={() => setView('map')} isDedicationDone={isDedicationDone} />}
                        {view === 'dedication' && <DedicationScene onFinish={() => { setIsDedicationDone(true); setView('result'); }} />}
                        {view === 'result' && <FinalResult levels={LEVELS} onRestart={() => window.location.reload()} />}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>